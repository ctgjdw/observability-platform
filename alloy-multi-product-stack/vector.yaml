sources:
  alloy_otlp_receiver:
    type: opentelemetry
    grpc:
      address: 0.0.0.0:4317
    http:
      address: 0.0.0.0:4318

transforms:
  drop_loki_labels:
    type: remap
    inputs:
      - alloy_otlp_receiver.logs
    source: |
      del(.attributes."loki.attribute.labels")

sinks:
  logs_console:
    type: console
    encoding:
      codec: json
    inputs:
      - drop_loki_labels
  logs_es_ingest:
    inputs:
      - "drop_loki_labels"
    type: "elasticsearch"
    endpoints:
      - https://opensearch:9200
    auth:
      password: admin
      strategy: basic
      user: admin
    tls:
      verify_certificate: false
    healthcheck:
      enabled: false
    api_version: v7
    mode: bulk
    bulk:
      index: 'logs-{{ .attributes."container_label_product" }}-%Y-%m-%d'
